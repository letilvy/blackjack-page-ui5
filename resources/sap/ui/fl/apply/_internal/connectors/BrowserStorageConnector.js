/*
 * ! OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/library","sap/ui/fl/apply/connectors/BaseConnector","sap/ui/fl/apply/_internal/connectors/BrowserStorageUtils","sap/ui/fl/Utils"],function(m,l,B,c,F){"use strict";function d(s,r){var a=[];var o;c.forEachChangeInStorage(s._items||s,function(k){o=JSON.parse(s.getItem(k));var S=o.reference===r||o.reference+".Component"===r;if(S){a.push(o);}}.bind(this));return a;}function g(a){var G={};Object.keys(l.Layer).forEach(function(L){G[L]={variants:[],variantChanges:[],variantManagementChanges:[],variantDependentControlChanges:[],changes:[],index:F.getLayerIndex(L)};});a.forEach(function(o){var L=o.layer;if(o.fileType==="ctrl_variant"&&o.variantManagementReference){G[L].variants.push(o);}else if(o.fileType==="ctrl_variant_change"){G[L].variantChanges.push(o);}else if(o.fileType==="ctrl_variant_management_change"){G[L].variantManagementChanges.push(o);}else if(o.fileType==="change"){if(o.variantReference){G[L].variantDependentControlChanges.push(o);}else{G[L].changes.push(o);}}});Object.keys(G).forEach(function(L){c.sortGroupedFlexObjects(G[L]);});return G;}function f(G){var r=[];Object.keys(G).forEach(function(L){r.push(G[L]);});r=r.filter(function(R){return R.changes.length>0||R.variants.length>0||R.variantChanges.length>0||R.variantManagementChanges.length>0||R.variantDependentControlChanges.length>0;});r.sort(function(a,b){return a.index-b.index;});return r;}var e=m({},B,{oStorage:undefined,loadFlexData:function(p){var a=d(this.oStorage,p.reference);var G=g(a);var r=f(G);return Promise.resolve(r);}});return e;},true);
